# 误提交到 main 分支

日期：2026-02-10

## 背景

AI agent 首次为项目添加 `AGENTS.md` 和修复 README 时，直接在 `main` 分支上 commit 并 push。

## 问题

- `main` 分支被直接修改，绕过了 `CONTRIBUTING.md` 中规定的 gitflow 流程
- 没有经过 PR review 就合并到了稳定发布分支

## 原因

- Agent 没有在执行前读取 `CONTRIBUTING.md` 的分支策略
- 当时尚未建立 AIEF context 体系，agent 缺少自动行为约定来引导正确流程

## 解决方案

1. 在 `main` 上执行 `git reset --hard` + `git push --force` 回退误提交
2. 切换到 `dev`，创建 `feature/*` 分支重新提交
3. 按 `feature/* -> PR 到 dev -> PR 到 main` 流程完成合并

## 可复用结论

- **任务开始前必须读 AGENTS.md 和 CONTRIBUTING.md 中的分支策略**
- Agent 应在首次 commit 前确认当前分支是否允许直接推送
- 建立 AIEF context 体系后，分支约束写入 `AGENTS.md` 的"开发硬约束"中，可有效防止此类问题
- `git push --force` 到 `main` 是高风险操作，仅在确认无他人依赖时使用
